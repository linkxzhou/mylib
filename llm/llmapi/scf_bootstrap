#!/bin/sh
set -e

PYTHON_BIN="/var/lang/python39/bin/python3.9"

if [ ! -x "$PYTHON_BIN" ]; then
  echo "Python 3.9 not found at $PYTHON_BIN" >&2
  exit 1
fi

# SCF 自定义运行时默认转发到 9000 端口
export PORT="${PORT:-9000}"
export HOST="${HOST:-0.0.0.0}"
export PYTHONUNBUFFERED=1
export FLASK_ENV="${FLASK_ENV:-production}"

# 若将依赖预打包到 ./python 目录（推荐），追加到 PYTHONPATH
if [ -d "./python" ]; then
  export PYTHONPATH="./python:${PYTHONPATH}"
fi

# 启动应用（以 llm_api.py 为入口）
exec "$PYTHON_BIN" llm_api.py